
from Crypto.Util.number import *
from Crypto.PublicKey import RSA
from gmpy2 import *
from pwn import *


def encrypt(m):
	return pow(m,e,n)

def decrypt(c):
	io.sendline('2')
	io.sendline(long_to_bytes(c).encode('hex'))
	x = io.recv()
        if '00' in x:
            return '00'
        else:
            return '01'
	return x
def oracle(c):
	x = decrypt(c)
	if x == '00':
		return 0
	else:
		return 1
	
def loop(num):
        io = remote("13.233.196.46", 8671)
        io.recv()
        x = io.recv().split()
        c = x[6]
        c = int(c,16)
        n = int(x[10])
        inv = pow(2,e,n)
        for i in range(num):
            c = (inv * c) % n
        return c

if __name__ == '__main__':
	io = remote("13.233.196.46", 8671)
	context.log_level = "debug"
	io.recv()
	x = io.recv().split()
	c = x[6]
	c = int(c,16)
	n = int(x[10])
	e = 65537
	inv = pow(2,e,n)
	low = 0
	high = n
	for i in range(2048-120):
		c = (inv * c)%n
		high = (low+high)/2
	for j in range(120):
                c = loop(2048-120+j)
		if oracle(c) == 0:
			high = (low + high)/2
		else:
			low = (low + high)/2
	print long_to_bytes(high)	
    
